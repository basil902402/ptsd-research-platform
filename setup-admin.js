// Ø³ÙƒØ±ÙŠØ¨Øª Ø¨Ø³ÙŠØ· Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø¯Ø§Ø±ÙŠ Ø¨Ø¯ÙˆÙ† ØªÙØ§Ø¹Ù„
require('dotenv').config();
const bcrypt = require('bcryptjs');
const { adminQueries, initDatabase } = require('./database');

async function createDefaultAdmin() {
    try {
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        initDatabase();

        const username = 'admin';
        const password = 'Admin@123456';

        // ØªØ¬Ø²Ø¦Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        const passwordHash = await bcrypt.hash(password, 10);

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        try {
            adminQueries.create.run(username, passwordHash);
            console.log(`\nâœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ Ø¨Ù†Ø¬Ø§Ø­`);
            console.log(`ğŸ“§ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${username}`);
            console.log(`ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${password}`);
            console.log(`\nâš ï¸  Ø§Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†!\n`);
        } catch (error) {
            if (error.message.includes('UNIQUE constraint failed')) {
                console.log('\nâœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                console.log(`ğŸ“§ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${username}`);
                console.log(`ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${password}\n`);
            } else {
                console.log('âŒ Ø®Ø·Ø£:', error.message);
            }
        }

    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£:', error.message);
    }
}

createDefaultAdmin();
